pipeline {
    agent any

    stages {
        stage('cleanup') {
            steps {
                deleteDir()
            }
        }
        stage('pull') {
            steps {
                git 'https://github.com/mohamedshaaban92/jenkins_nodejs_example.git'
            }
        }
        stage('build') {
            steps {
                sh "docker build -t elarief92/jenkins_nodejs:${BUILD_NUMBER} ."
            }
    }
        
        stage('push') {
           steps {
                withCredentials([usernamePassword(credentialsId:"docker-hub",usernameVariable:"username",passwordVariable:"pass")]){
                sh 'docker build . -t ${username}/jenkins_sprints:${BUILD_NUMBER}'
                sh 'docker login -u ${username} -p ${pass}'
                sh 'docker push ${username}/jenkins_nodejs:${BUILD_NUMBER}'
             }
        }
        }
        }
        post {
                success {
                    echo "build succeeded"
                }
                failure {
                    echo "build failed"
                }
            }
    }
